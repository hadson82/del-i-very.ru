<?phprequire(dirname(__FILE__).'/../../config/config.inc.php');include_once(dirname(__FILE__).'/../../init.php');global $cookie;function get_ip(){	$ip = false;		if(!empty($_SERVER['HTTP_CLIENT_IP']))        $ip = $_SERVER['HTTP_CLIENT_IP'];        elseif(!empty($_SERVER['HTTP_X_FORWARDED_FOR']))        $ip = $_SERVER['HTTP_X_FORWARDED_FOR'];        else        $ip = $_SERVER['REMOTE_ADDR'];   		return $ip;}if(empty($cookie->date_add))	die('d');	$user_id = false;$click_count_user = 0;$banner_id = $_POST['b_id'] ? (int)$_POST['b_id'] : false;if(empty($banner_id))	die('p');	$user_ip = get_ip();if(empty($user_ip))	die('a');$check_id = Db::getInstance()->getRow('	SELECT id FROM '._DB_PREFIX_.'blmod_upl_banner	WHERE id = "'.$banner_id.'" AND status = "1" ');if(empty($check_id['id']))	die('wb');			if(!empty($cookie->id_customer) and $cookie->isLogged()){	$user_id = (int)$cookie->id_customer;	$sql_unique = 'user_id = "'.$user_id.'"';}else	$sql_unique = 'user_ip = "'.$user_ip.'"';$now = date('Y-m-d');	$click_unique = Db::getInstance()->getRow('	SELECT banner_id FROM '._DB_PREFIX_.'blmod_upl_clicks	WHERE banner_id = "'.$banner_id.'" AND '.$sql_unique.' AND date LIKE "'.$now.'%"');	Db::getInstance()->Execute('	INSERT INTO '._DB_PREFIX_.'blmod_upl_clicks	(`banner_id`, `user_id`, `user_ip`, `date`, `page_address`)	VALUES	("'.$banner_id.'", "'.$user_id.'", "'.$user_ip.'", "'.date('Y-m-d H:i:s').'", "'.htmlspecialchars($_SERVER['HTTP_REFERER'], ENT_QUOTES).'")	');$sql_unique = '';if(empty($click_unique['banner_id']))	$sql_unique = ', click_unique = click_unique + 1';	Db::getInstance()->Execute('	UPDATE '._DB_PREFIX_.'blmod_upl_banner SET	click_total = click_total + 1'.$sql_unique.'	WHERE id = "'.$banner_id.'"');//Update days clicks		Db::getInstance()->Execute('	UPDATE '._DB_PREFIX_.'blmod_upl_views 	SET click_total = click_total + 1'.$sql_unique.' 	WHERE `banner_id` = "'.$banner_id.'" AND `date` = "'.$now.'"');	echo 1;?>